<div class="row">
    <div class="offset-11 col-1 d-flex flex-row-reverse ">
        <button class="fix-button" mat-icon-button (click)="close()">
          <mat-icon style="line-height: 23px;">cancel</mat-icon>
      </button>
    </div>
</div>

<mat-card-title class="card-header text-center" *ngIf="isView">
    Thông tin phiếu sữa
</mat-card-title>
<mat-card-title class="card-header text-center" *ngIf="isCreate">
    Thêm phiếu sữa
</mat-card-title>
<mat-card-title class="card-header text-center" *ngIf="!isView && !isCreate">
    Chỉnh sửa phiếu sữa
</mat-card-title>

<mat-tab-group>
    <mat-tab label="Thông tin">
        <mat-card>
            <form class="parent-form" name="form" novalidate (ngSubmit)="f.form.valid && create()" #f="ngForm">
                <div class="row">
                    <div class="col-lg-6">

                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Nhân viên</mat-label>
                            <mat-select [(ngModel)]="sourceView.employeeId" name="employeeId" [disabled]="isView" #employeeId="ngModel">
                                <mat-option>---</mat-option>
                                <mat-option *ngFor="let employee of employees" [value]="employee.id">{{ employee.fullName }} -- ID:{{employee.id}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <!-- <div class="col-lg-6">
                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Mã nhân viên</mat-label>
                            <input id="employeeId" [(ngModel)]="sourceView.employeeId" name="employeeId" #name="ngModel" matInput placeholder="id" [disabled]="isView">
                            <mat-error *ngIf="f.submitted && name.invalid && name.errors.required">Mã nhân viên không được bỏ trống
                            </mat-error>
                        </mat-form-field>
                    </div> -->
                    <div class="col-lg-6">
                        <!-- <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Mã nông dân</mat-label>
                            <input id="farmerId" [(ngModel)]="sourceView.farmerId" name="farmerId" matInput placeholder="id" [disabled]="isView">
                        </mat-form-field> -->

                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Nông dân</mat-label>
                            <mat-select [(ngModel)]="sourceView.farmerId" name="farmerId" [disabled]="isView" #farmerId="ngModel">
                                <mat-option>---</mat-option>
                                <mat-option *ngFor="let farmer of farmers" [value]="farmer.id">{{ farmer.fullName }} -- ID:{{farmer.id}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <!-- <div class="col-lg-6">
              <mat-form-field class="input-fluid" appearance="outline">
                  <h6 style="color: grey;">Tỉnh</h6>
                  <mat-select [ngModelOptions]="{ standalone: true }" [(ngModel)]="sourceView.provinceId" [placeholder]="sourceView.provinceName" id="provinceId" name="provinceId" [disabled]="isView">
                      <mat-option *ngFor="let province of provinces" [value]="province.id">{{province.name}}
                      </mat-option>
                  </mat-select>
              </mat-form-field>
          </div> -->
                    <div class="col-lg-6">
                        <!-- <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Mã trạm sữa</mat-label>
                            <input id="milkCollectionStationId" [(ngModel)]="sourceView.milkCollectionStationId" name="milkCollectionStationId" matInput placeholder="" [disabled]="isView">
                        </mat-form-field> -->

                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Trạm sữa</mat-label>
                            <mat-select [(ngModel)]="sourceView.milkCollectionStationId" name="milkCollectionStationId" [disabled]="isView" #milkCollectionStationId="ngModel" (selectionChange)="getStorageTanks(sourceView.milkCollectionStationId)">
                                <mat-option>---</mat-option>
                                <mat-option *ngFor="let milkStation of milkStations" [value]="milkStation.id">{{milkStation.name}} -- {{milkStation.address}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-6">
                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Ngày tạo phiếu</mat-label>
                            <input matInput [matDatepicker]="picker2" [(ngModel)]="sourceView.createdDate" [disabled]="isView" [ngModelOptions]="{ standalone: true }" />
                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                            <mat-datepicker #picker2></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-6">
                        <!-- <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Mã bình chứa</mat-label>
                            <input id="storageTankCode" [(ngModel)]="sourceView.storageTankId" name="storageTankCode" matInput placeholder="" [disabled]="isView">
                        </mat-form-field> -->

                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Bình chứa</mat-label>
                            <mat-select [(ngModel)]="sourceView.storageTankId" name="storageTankId" [disabled]="isView" #storageTankId="ngModel">
                                <mat-option>---</mat-option>
                                <mat-option *ngFor="let storageTank of storageTanks" [value]="storageTank.id">{{storageTank.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-6">
                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Phiên</mat-label>
                            <input id="session" [(ngModel)]="sourceView.session" name="session" matInput placeholder="" [disabled]="isView">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-6">
                        <mat-form-field class="input-fluid" appearance="outline">
                            <mat-label>Code</mat-label>
                            <input id="code" [(ngModel)]="sourceView.code" name="code" matInput placeholder="" [disabled]="isView">
                        </mat-form-field>
                    </div>
                </div>
                <!-- <mat-form-field class="input-fluid" appearance="outline">
          <mat-label>Code</mat-label>
          <input id="code" [(ngModel)]="sourceView.code" name="code" matInput placeholder="Code" [disabled]="isView">
      </mat-form-field> -->
                <div style="margin:0 auto;text-align: center;">
                    <button mat-raised-button class="btn btn-outline-success" type="submit" *ngIf="isCreate">
               Thêm
          </button>
                </div>
            </form>
            <div style="margin:0 auto;text-align: center;">
                <button type="button" mat-raised-button class="btn btn-outline-danger" *ngIf="isView" (click)="delete()"><i
              class="fas fa-trash-alt"></i> Xóa</button>
                <button type="button" mat-raised-button class="btn btn-outline-danger" *ngIf="!isView && !isCreate" (click)="discard()">Bỏ thay đổi</button>
                <button type="button" mat-raised-button class="btn btn-outline-success" *ngIf="!isView && !isCreate" (click)="save()">Lưu thay đổi</button>
                <button type="button" mat-raised-button class="btn btn-outline-success" *ngIf="isView" (click)="edit()">Chỉnh
          sửa</button>
            </div>
        </mat-card>
    </mat-tab>
    <mat-tab label="Chi tiết" *ngIf="!isCreate">
        <button mat-icon-button color="warn" matTooltip="Thêm mới" *ngIf="!isCreate" (click)="popUpAddMilkCouponDetail()">
    <mat-icon>add</mat-icon>
  </button>
        <div class="mat-elevation-z8">
            <mat-paginator [pageSizeOptions]="[10,20,50]">
            </mat-paginator>
            <table mat-table [dataSource]="dataSource" matSort>
                <ng-container matColumnDef="milkCouponId">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Mã phiếu sữa</th>
                    <td mat-cell *matCellDef="let detailOfCoupon">{{detailOfCoupon.milkCouponId}}</td>
                </ng-container>

                <ng-container matColumnDef="quantity">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Số lượng</th>
                    <td mat-cell *matCellDef="let detailOfCoupon">{{detailOfCoupon.quantity}}</td>
                </ng-container>

                <ng-container matColumnDef="typeMilk">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Loại sữa</th>
                    <td mat-cell *matCellDef="let detailOfCoupon">{{detailOfCoupon.typeMilk}}</td>
                </ng-container>

                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef width="5%"></th>
                    <td mat-cell *matCellDef="let detail">
                        <button (click)="deleteDetailOfCoupon(detail)" mat-icon-button color="primary">
              <mat-icon>delete</mat-icon>
            </button>
                    </td>
                </ng-container>
                <tr mat-row class="table-row" *matRowDef="let assetCategoryPart; columns: displayedColumns; ">
                </tr>
                <tr mat-header-row *matHeaderRowDef="displayedColumns, sticky:true"></tr>
            </table>
        </div>
    </mat-tab>
</mat-tab-group>